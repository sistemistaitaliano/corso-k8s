<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Come installare Kubernetes su Rocky Linux 9 / AlmaLinux 9</title>
  <style>
    body{font-family:Inter,Segoe UI,Arial,sans-serif;line-height:1.6;margin:30px;max-width:900px}
    pre{background:#f6f8fa;padding:12px;border-radius:6px;overflow:auto}
    h1,h2,h3{color:#1f2937}
    code{background:#eef2ff;padding:2px 4px;border-radius:4px}
  </style>
</head>
<body>
  <h1>Come installare Kubernetes su Rocky Linux 9 / AlmaLinux 9</h1>
  <p><em>Traduzione in italiano dell'articolo originale di Pradeep Kumar.</em></p>
  <p><strong>Prerequisiti</strong></p>
  <ul>
    <li>Installazione fresca di Rocky Linux 9 o AlmaLinux 9</li>
    <li>Utente con permessi <code>sudo</code></li>
    <li>Minimo 2 GB RAM, 2 vCPU e 20 GB di disco</li>
    <li>Connessione Internet affidabile</li>
  </ul>

  <h2>Ambiente di laboratorio (esempio usato)</h2>
  <ul>
    <li><code>k8s-master01</code> – 192.168.1.190</li>
    <li><code>k8s-worker01</code> – 192.168.1.191</li>
    <li><code>k8s-worker02</code> – 192.168.1.192</li>
    <li>Utente: <code>sysops</code> (con sudo) su ogni nodo</li>
  </ul>

  <h2>Passo 1: Impostare hostname e aggiornare /etc/hosts</h2>
  <p>Accedi (o fai ssh) su ogni macchina e imposta l'hostname:</p>
  <pre><code>$ sudo hostnamectl set-hostname "k8s-master01" && exec bash
$ sudo hostnamectl set-hostname "k8s-worker01" && exec bash
$ sudo hostnamectl set-hostname "k8s-worker02" && exec bash</code></pre>
  <p>Aggiungi queste righe in <code>/etc/hosts</code> su ogni nodo:</p>
  <pre><code>192.168.1.190   k8s-master01
192.168.1.191   k8s-worker01
192.168.1.192   k8s-worker02</code></pre>

  <h2>Passo 2: Disabilitare lo swap su ogni nodo</h2>
  <p>Per far funzionare kubelet è necessario disabilitare lo swap:</p>
  <pre><code>$ sudo swapoff -a
$ sudo sed -i '/ swap / s/^\(.*\)$/#\1/g' /etc/fstab</code></pre>

  <h2>Passo 3: SELinux e regole del firewall</h2>
  <p>Imposta SELinux in modalità permissive su tutti i nodi:</p>
  <pre><code>$ sudo setenforce 0
$ sudo sed -i --follow-symlinks 's/SELINUX=enforcing/SELINUX=permissive/g' /etc/sysconfig/selinux</code></pre>
  <p>Sul nodo master apri queste porte (firewalld):</p>
  <pre><code>$ sudo firewall-cmd --permanent --add-port={6443,2379,2380,10250,10251,10252,10257,10259,179}/tcp
$ sudo firewall-cmd --permanent --add-port=4789/udp
$ sudo firewall-cmd --reload</code></pre>
  <p>Su ogni worker apri:</p>
  <pre><code>$ sudo firewall-cmd --permanent --add-port={179,10250,30000-32767}/tcp
$ sudo firewall-cmd --permanent --add-port=4789/udp
$ sudo firewall-cmd --reload</code></pre>

  <h2>Passo 4: Moduli kernel e parametri</h2>
  <p>Carica i moduli <code>overlay</code> e <code>br_netfilter</code> su tutti i nodi:</p>
  <pre><code>$ sudo tee /etc/modules-load.d/containerd.conf <<EOF
overlay
br_netfilter
EOF

$ sudo modprobe overlay
$ sudo modprobe br_netfilter</code></pre>
  <p>Aggiungi i parametri di sysctl:</p>
  <pre><code>$ sudo vi /etc/sysctl.d/k8s.conf
# inserire:
net.bridge.bridge-nf-call-iptables  = 1
net.ipv4.ip_forward                 = 1
net.bridge.bridge-nf-call-ip6tables = 1

# applicare:
$ sudo sysctl --system</code></pre>

  <h2>Passo 5: Installare il runtime containerd</h2>
  <p>Aggiungi il repository Docker (necessario per <code>containerd</code>):</p>
  <pre><code>$ sudo dnf config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</code></pre>
  <p>Installa containerd:</p>
  <pre><code>$ sudo dnf install containerd.io -y</code></pre>
  <p>Configura containerd per usare systemd cgroup:</p>
  <pre><code>$ containerd config default | sudo tee /etc/containerd/config.toml >/dev/null 2>&1
$ sudo sed -i 's/SystemdCgroup = false/SystemdCgroup = true/g' /etc/containerd/config.toml

$ sudo systemctl restart containerd
$ sudo systemctl enable containerd

# Verifica
$ sudo systemctl status containerd</code></pre>

  <h2>Passo 6: Installare gli strumenti Kubernetes (kubeadm, kubectl, kubelet)</h2>
  <p>Aggiungi il repository ufficiale dei pacchetti Kubernetes (nell'articolo originale era indicata la serie v1.28):</p>
  <pre><code>$ cat <<EOF | sudo tee /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://pkgs.k8s.io/core:/stable:/v1.28/rpm/
enabled=1
gpgcheck=1
gpgkey=https://pkgs.k8s.io/core:/stable:/v1.28/rpm/repodata/repomd.xml.key
exclude=kubelet kubeadm kubectl cri-tools kubernetes-cni
EOF</code></pre>
  <p>Installa gli strumenti:</p>
  <pre><code>$ sudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes

$ sudo systemctl enable --now kubelet</code></pre>

  <h2>Passo 7: Inizializzare il cluster Kubernetes (master)</h2>
  <p>Da <code>k8s-master01</code> esegui:</p>
  <pre><code>$ sudo kubeadm init --control-plane-endpoint=k8s-master01</code></pre>
  <p>Dall'output prendi il comando suggerito per far unire i worker al cluster. Per usare kubectl sul master:</p>
  <pre><code>$ mkdir -p $HOME/.kube
$ sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
$ sudo chown $(id -u):$(id -g) $HOME/.kube/config</code></pre>
  <p>Sui worker esegui il comando <code>kubeadm join ...</code> fornito dall'output del master.</p>

  <h2>Passo 8: Installare Calico (CNI)</h2>
  <p>Per abilitare il networking fra i pod e rendere i nodi <code>Ready</code> installa Calico (esempio con versione indicata nell'articolo):</p>
  <pre><code>$ kubectl apply -f https://raw.githubusercontent.com/projectcalico/calico/v3.26.1/manifests/calico.yaml</code></pre>
  <p>Verifica i pod nel namespace <code>kube-system</code>:</p>
  <pre><code>$ kubectl get pods -n kube-system
$ kubectl get nodes</code></pre>

  <h2>Passo 9: Test dell'installazione</h2>
  <p>Distribuisci una semplice applicazione nginx per testare:</p>
  <pre><code>$ kubectl create deployment web-app01 --image nginx --replicas 2
$ kubectl expose deployment web-app01 --type NodePort --port 80
$ kubectl get deployment web-app01
$ kubectl get pods
$ kubectl get svc web-app01</code></pre>
  <p>Puoi provare ad accedere usando il NodePort (es.: <code>31121</code>):</p>
  <pre><code>$ curl k8s-worker01:31121</code></pre>

  <hr>
  <p>Fine della guida tradotta. Questa pagina è una traduzione dell'articolo originale presente su LinuxTechi. Se vuoi che generi una versione pronta per essere messa su un sito (HTML più grafica, immagini e metadata SEO), o una versione markdown/README, dimmi quale formato preferisci e la preparo.</p>
</body>
</html>
