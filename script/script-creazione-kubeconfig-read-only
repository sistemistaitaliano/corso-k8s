# Percorso kubeconfig
$KubeConfig = "D:\k8s\readonly.kubeconfig"

# Imposta cluster (server API e certificato CA)
kubectl config set-cluster my-cluster `
  --server=https://192.168.1.17:6443 `
  --certificate-authority="D:\k8s\ca.crt" `
  --kubeconfig=$KubeConfig

# Imposta credenziali con token
kubectl config set-credentials readonly-user `
  --token=eyJhbGciOiJSUzI1NiIsImtpZCI6IllpT2k0VkNPdVhYTHpfQzAteEpHY2RwOF9UOTZzRDJZN1Z6WlM5YXM1MkUifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNzU4NjQwMjcwLCJpYXQiOjE3NTg2MzY2NzAsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwianRpIjoiOWZlOGYxNzgtOTE2MS00NGM0LTk5MGItMWZkZjI4MDE3MzUzIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0Iiwic2VydmljZWFjY291bnQiOnsibmFtZSI6InJlYWRvbmx5LXVzZXIiLCJ1aWQiOiIzMWIyMzE4Yi1mZWUzLTQ1ZmQtODdlNS1mMzFmMGQ4MjVlNzcifX0sIm5iZiI6MTc1ODYzNjY3MCwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OmRlZmF1bHQ6cmVhZG9ubHktdXNlciJ9.o0KRAY8o2_HCSuAc_-ejmwtx7owSpUGRA64kC0QTfXTJOwO1kUJkawARILoq-oJp3Lmty00seiIJ2_ogkDM_49OYBvWDiYrE2H1hbqEPuujmyvOm4h1myxvv8ftdIQbBN00YD2oCFnV8bVNhq3IL5PTkHnD0tb0knY85aGnINYTBBLGrWNyx0eX6spMqWr7wsVRYiLE78jo_8B4BRnLgGa9_Omd3FE4-nKj2cjEJ_-R9YVXNfKmlW0SbZBjtmJfhAw7J_gxPJEalY8Ct8iszmoKF3DWUHjQdckK9Uls4kae7hENisaxaYjAwd6WLChqs1F3zh7dvCbObucdqP2NwgA `
  --kubeconfig=$KubeConfig

# Crea un contesto che lega utente e cluster
kubectl config set-context readonly-context `
  --cluster=my-cluster `
  --user=readonly-user `
  --namespace=default `
  --kubeconfig=$KubeConfig

# Imposta il contesto come predefinito
kubectl config use-context readonly-context --kubeconfig=$KubeConfig